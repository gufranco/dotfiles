#!/usr/bin/env bash

################################################################################
# System specific functions
################################################################################
case "$(uname)" in
  Linux)
    ############################################################################
    # Open the current directory, otherwise open the given location
    ############################################################################
    function open() {
      if [ $# -eq 0 ]; then
        xdg-open . > /dev/null 2>&1;
      else
        xdg-open "$@" > /dev/null 2>&1;
      fi;
    }

  ;;
  Darwin)

  ;;
esac

################################################################################
# Update and upgrade everything
################################################################################
function f5() {
  CURRENT_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd -P)

  case "$(uname)" in
    Linux)
      sudo apt update -y
      sudo apt dist-upgrade -y
      sudo apt autoremove -y
      sudo apt clean all -y

    ;;

    Darwin)
      brew update
      brew upgrade
      brew cu --all --yes --cleanup
      brew cleanup -s
      brew bundle --file ~/.dotfiles/Brewfile
      brew bundle --file ~/.dotfiles/Brewfile --force cleanup
      mas upgrade
      sudo softwareupdate -i -a

    ;;
  esac

  # Dotfiles
  cd ~/.dotfiles || exit 1
  git pull-sub
  git submodule update --recursive --remote

  # Vim
  vim +PlugUpgrade +PlugUpdate +qall

  # Oh-my-zsh
  cd ~/.oh-my-zsh || exit 1
  git checkout master
  git pull

  # Spaceship theme
  cd ~/.oh-my-zsh/custom/themes/spaceship-prompt || exit 1
  git checkout master
  git pull

  # Reload shell
  source "${HOME}/.zshrc"

  cd "$CURRENT_DIR" || exit 1
}
