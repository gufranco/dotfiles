#!/usr/bin/env bash

################################################################################
# System specific settings
################################################################################
case "$(uname)" in
  "Linux")

    ;;
  "Darwin")
    # Zsh
    export ZSH_DISABLE_COMPFIX=true

    # Homebrew
    export HOMEBREW_NO_ANALYTICS=true
    export HOMEBREW_NO_ENV_HINTS=true
    export HOMEBREW_NO_AUTO_UPDATE=true
    export HOMEBREW_QUIET=true

    # Docker
    # export DOCKER_DEFAULT_PLATFORM="linux/amd64"

    ;;
esac

################################################################################
# Shell
################################################################################
export HISTCONTROL=ignoredups
export HISTIGNORE="cd:ls:[bf]g:clear:exit"
export LANG=pt_BR.UTF-8

################################################################################
# Oh-my-zsh
################################################################################
export ZSH="$HOME/.oh-my-zsh"
export ZSH_THEME="spaceship"
export DISABLE_AUTO_UPDATE="true"
export HIST_STAMPS="dd/mm/yyyy"
export plugins=(
  # Security & Authentication
  gpg-agent
  ssh-agent

  # Shell Interface & Experience
  zsh-syntax-highlighting
  you-should-use
  zsh-completions
  colored-man-pages
  sudo
  zsh-z
  zsh-autocomplete

  # Version Control & Git
  git
  gitignore
  github

  # Containers & Orchestration
  docker
  docker-compose
  kubectl

  # Cloud & DevOps
  aws

  # Programming Languages - JavaScript/TypeScript
  node
  npm
  yarn

  # Programming Languages - Python
  python
  pip

  # Programming Languages - Ruby
  ruby
  gem
  bundler

  # Programming Languages - Go
  golang

  # Editors & IDEs
  sublime
  vscode

  # Terminal & Multiplexing
  tmux

  # File Operations & Search
  fzf
  rsync
  extract

  # System & Package Management
  macos
  brew

  # Development Tools
  stripe
  rclone

  # Productivity & Misc
  web-search
  copyfile
)

################################################################################
# Spaceship
################################################################################
export SPACESHIP_USER_SHOW=always
export SPACESHIP_PROMPT_ADD_NEWLINE=false
export SPACESHIP_CHAR_SYMBOL="❯"
export SPACESHIP_CHAR_SUFFIX=" "

################################################################################
# Npm
################################################################################
if [ -z "$NPM_TOKEN" ]; then
  export NPM_TOKEN_CACHE_FILE="$HOME/.dotfiles/nodejs/tokens/classic.cache"

  if [ ! -f "$NPM_TOKEN_CACHE_FILE" ] || [ $(( $(date +%s) - $(stat -f %m "$NPM_TOKEN_CACHE_FILE" 2>/dev/null || echo 0) )) -gt 86400 ]; then
    gpg --quiet --batch --yes -d "$HOME/.dotfiles/nodejs/tokens/classic.gpg" | tr -d '\n' > "$NPM_TOKEN_CACHE_FILE"
    chmod 600 "$NPM_TOKEN_CACHE_FILE"
  fi

  # shellcheck disable=SC2155
  export NPM_TOKEN="$(cat $NPM_TOKEN_CACHE_FILE)"
fi
