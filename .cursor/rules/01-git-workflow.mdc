---
description: Git commits, branches, PRs, and CI/CD monitoring
alwaysApply: true
---

# Git Workflow

This file defines **commit format**, **branch naming**, **PR creation**, and **CI monitoring**. See `00-core.mdc` for core principles; `02-task-completion.mdc` for delivery and verification.

## Commit Format
```
<type>(<scope>): <subject>

<body>

<footer>
```

### Types (required)
`feat`, `fix`, `docs`, `style`, `refactor`, `perf`, `test`, `build`, `ci`, `chore`, `revert`

### Subject Rules
- Imperative mood: "add" not "added" or "adds"
- No caps at start, no period at end
- Max 50 characters

| ❌ NEVER | ✅ CORRECT |
|----------|------------|
| `Added user authentication` | `add user authentication` |
| `Adds login feature` | `add login feature` |
| `Fix bug.` | `fix login redirect` |
| `Update` | `update password validation rules` |
| `WIP` | `add email verification (incomplete)` |

### Body (optional)
- Wrap at 72 characters
- Explain WHAT and WHY, not HOW
- Use bullet points if needed

### Footer (optional)
- `BREAKING CHANGE:` (or `BREAKING-CHANGE:`) for breaking changes; alternatively put `!` after type/scope (e.g. `feat(api)!: change response format`) so the subject itself signals breaking
- `Fixes #123`, `Closes #456`, `Refs #789`
- **NEVER** add `Co-authored-by: Cursor <cursoragent@cursor.com>` or any Cursor agent co-author line to commits

### Complete Examples

```
# ❌ NEVER - vague, wrong tense, no context
Fixed stuff

# ✅ CORRECT - simple fix
fix(auth): handle expired refresh tokens
```

```
# ✅ CORRECT - with body explaining why
feat(api): add rate limiting to auth endpoints

Auth endpoints were vulnerable to brute force attacks.
Added sliding window rate limiting:
- 5 requests/minute for login
- 3 requests/minute for password reset

Refs PROJ-1234
```

```
# ✅ CORRECT - breaking change
feat(api): change user response format

BREAKING CHANGE: User endpoint now returns nested address object.
Before: { street, city, country }
After: { address: { street, city, country } }

Migration guide: Update client code to access user.address.street
instead of user.street.

Closes #456
```

## Branch Naming

### Tool-Generated Branches (preferred)
Use branch names generated by project management tools:

| Tool | Format | Example |
|------|--------|---------|
| Linear | `<user>/<issue-id>-<slug>` | `username/proj-1234-auth` |
| Jira | `<issue-key>-<summary>` | `PROJ-1234-user-auth` |
| GitHub Issues | `<issue-number>-<slug>` | `123-fix-login` |

### Manual Branches
```
<type>/<ticket-id>-<description>
```
Types: `feature/`, `bugfix/`, `hotfix/`, `release/`, `chore/`

## PR/MR Creation

### Title Format
```
<TICKET-ID>: <description>
```

### CLI Commands (preferred over web UI)
```bash
# Create PR
gh pr create --title "<TICKET-ID>: <desc>" --body-file pr.md --base staging

# Auto-fill from commits
gh pr create --fill --base staging

# Create draft PR
gh pr create --draft --title "<TICKET-ID>: WIP" --base staging

# Check PR status
gh pr status

# Merge PR
gh pr merge <number> --squash --delete-branch
```

## CI/CD Monitoring (MANDATORY)
After ANY push:
1. Run `gh pr checks --watch`
2. Wait for ALL checks
3. If failed: `gh run view <id> --log-failed`
4. **Before fixing**: Search for an existing fix:
   - **Source branch**: Same failure on main/staging?
   - **Open PRs/MRs**: Use `gh pr list` / `gh pr view <n>` (GitHub) or `glab mr list` / `glab mr view <n>` (GitLab) if installed — list open PRs/MRs and **inspect their content** (diffs, CI status). Does another PR/MR already fix this?
   - **Remote branches**: `git fetch origin` then `git branch -r`; check relevant remote branches for the same failure or an existing fix.
   - If a fix exists elsewhere: reuse (cherry-pick, rebase onto that branch, or apply the same change). See `00-core.mdc` → Reuse First.
5. If no existing fix: Fix → Push → Repeat until green

**Never** mark task complete with failing/running pipeline.

## Post-Task Workflow
After completing significant features:
1. Stage and commit with conventional message
2. Push to remote: `git push`
3. Verify remote is updated

**Keep remote in sync.** Don't accumulate local-only commits.

## Conflict Resolution
```bash
git fetch origin && git rebase origin/staging
# Resolve conflicts manually
git add <file> && git rebase --continue
# Test locally, then:
git push --force-with-lease
```

## GPG Signing
If a commit fails due to GPG signing issues (e.g., "gpg failed to sign the data", "Inappropriate ioctl for device"), retry without GPG signing:

```bash
git commit --no-gpg-sign -m "message"
```

This typically happens in non-interactive terminal environments where GPG cannot prompt for the passphrase.
