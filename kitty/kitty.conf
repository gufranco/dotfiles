################################################################################
# Kitty Terminal Configuration
################################################################################
# Enhanced configuration for maximum usability, performance, and beauty
# Optimized for Kitty 0.44.0+ on macOS
# Battery-optimized settings for Mac M1 (reduced CPU/GPU usage)

################################################################################
# Theme
################################################################################
# Include Tokyo Night theme
include themes/tokyo-night.conf

################################################################################
# Font & Typography
################################################################################
# Primary font with fallbacks (exact names from installed fonts)
font_family JetBrainsMono Nerd Font Mono
bold_font JetBrainsMono Nerd Font Mono Bold
italic_font JetBrainsMono Nerd Font Mono Italic
bold_italic_font JetBrainsMono Nerd Font Mono Bold Italic

# Font size
font_size 14.0

# Disable font features (can cause rendering issues with Nerd Fonts)
# font_features none

# Ligatures - disabled for better performance and battery life
disable_ligatures always

# Symbol map for Nerd Fonts (use same font for better consistency)
symbol_map U+23FB-U+23FE,U+2665,U+26A1,U+2B58,U+E000-U+E00A,U+E0A0-U+E0A3,U+E0B0-U+E0C8,U+E0CA,U+E0CC-U+E0D4,U+E200-U+E2A9,U+E300-U+E3E3,U+E5FA-U+E6AA,U+E700-U+E7C5,U+EA60-U+EBEB,U+F000-U+F2E0,U+F300-U+F32F,U+F400-U+F4A9,U+F500-U+F8FF,U+F0001-U+F1AF0 JetBrainsMono Nerd Font Mono

# Text composition (better for performance)
text_composition_strategy platform

# Adjust line height and baseline
adjust_line_height 0
adjust_column_width 0
adjust_baseline 0

# Box drawing characters - use Unicode for Nerd Fonts compatibility
box_drawing_scale 0.001, 1, 1.5, 2

################################################################################
# Performance & Rendering
################################################################################
# Rendering optimizations - tuned for battery life on Mac M1
# Increased delays to reduce CPU/GPU usage and battery consumption
repaint_delay 30
input_delay 10
sync_to_monitor no

# Background - no transparency for better performance
background_opacity 1.0
dynamic_background_opacity no
background_blur 0
background_image none
dim_opacity 0.75

# Fix rendering issues when returning from minimized/suspended state
# This prevents the "blank window" bug on macOS
resize_draw_strategy static
force_ltr no

################################################################################
# Scrollback
################################################################################
# Reduced for better memory usage and battery life
scrollback_lines 2000
scrollback_pager less --chop-long-lines --RAW-CONTROL-CHARS +INPUT_LINE_NUMBER
scrollback_pager_history_size 0
scrollback_fill_enlarged_window no
wheel_scroll_multiplier 5.0
wheel_scroll_min_lines 1
touch_scroll_multiplier 1.0

################################################################################
# Mouse
################################################################################
mouse_hide_wait 5.0
focus_follows_mouse no
pointer_shape_when_grabbed arrow
default_pointer_shape beam
pointer_shape_when_dragging beam

# Mouse actions
clear_all_mouse_actions no
mouse_map left click ungrabbed mouse_handle_click selection link prompt
mouse_map shift+left click grabbed,ungrabbed mouse_handle_click selection link prompt
mouse_map ctrl+shift+left release grabbed,ungrabbed mouse_handle_click link
mouse_map ctrl+shift+left press grabbed discard_event
mouse_map middle release ungrabbed paste_from_selection
mouse_map left press ungrabbed mouse_selection normal
mouse_map ctrl+alt+left press ungrabbed mouse_selection rectangle
mouse_map left doubleclick ungrabbed mouse_selection word
mouse_map left tripleclick ungrabbed mouse_selection line
mouse_map ctrl+alt+left tripleclick ungrabbed mouse_selection line_from_point
mouse_map right press ungrabbed mouse_selection extend
mouse_map shift+middle release ungrabbed,grabbed paste_selection
mouse_map shift+middle press grabbed discard_event

################################################################################
# Window & Layout Management
################################################################################
# Window settings
remember_window_size yes
initial_window_width 120c
initial_window_height 30c
window_border_width 0pt
window_margin_width 0
window_padding_width 4
single_window_padding_width 4
placement_strategy center
inactive_text_alpha 1.0
hide_window_decorations no
window_resize_step_cells 2
window_resize_step_lines 2
confirm_os_window_close 0

# Tab management
tab_bar_edge bottom
tab_bar_margin_width 0.0
tab_bar_margin_height 0.0 0.0
tab_bar_style fade
tab_bar_align left
tab_bar_min_tabs 2
tab_switch_strategy previous
tab_fade 0 0 0 0
tab_separator " â”‡"
tab_powerline_style angled
tab_activity_symbol none
tab_title_template "{fmt.fg.red}{bell_symbol}{activity_symbol}{fmt.fg.tab}{title}"
active_tab_title_template none

# Layouts
enabled_layouts tall:bias=50;full_size=1;mirrored=false,fat:bias=50;full_size=1;mirrored=false,stack,grid,horizontal,vertical,splits
layout_name stack
window_logo_path none
window_logo_position bottom-right
window_logo_alpha 0.5
resize_debounce_time 0.3
resize_in_steps no

################################################################################
# Bell & Notifications
################################################################################
enable_audio_bell no
visual_bell_duration 0.0
visual_bell_color none
window_alert_on_bell yes
bell_on_tab "ðŸ”” "
command_on_bell none
bell_path none

################################################################################
# Terminal Features
################################################################################
term xterm-kitty
shell_integration enabled
# Remote control disabled for security (enable only if needed for specific scripts)
allow_remote_control no
# listen_on unix:/tmp/mykitty
clipboard_control write-clipboard write-primary read-clipboard-ask read-primary-ask
clipboard_max_size 256
file_transfer_confirmation_bypass

################################################################################
# URL Handling
################################################################################
# Disabled to reduce CPU usage from constant text scanning
detect_urls no
url_color #73daca
url_style curly
open_url_with default
url_prefixes file ftp ftps gemini git gopher http https irc ircs kitty mailto news sftp ssh
show_hyperlink_targets no
underline_hyperlinks never
underline_position_offset 0

################################################################################
# Advanced
################################################################################
# Startup session
startup_session none
allow_cloning ask
clone_source_strategies venv,conda,env_var,path

# Close behavior
close_on_child_death no

# Environment
env TERM_PROGRAM=kitty
env TERM_PROGRAM_VERSION=0.44.0

################################################################################
# macOS Integration
################################################################################
# macOS specific settings
macos_titlebar_color #1a1b26
macos_option_as_alt yes
macos_hide_from_tasks no
macos_quit_when_last_window_closed no
macos_window_resizable yes
macos_thicken_font 0.0
macos_traditional_fullscreen no
macos_show_window_title_in all
macos_menubar_title_max_length 0
macos_custom_beam_cursor no
macos_colorspace srgb

# Fix for blank window after waking from sleep or being minimized
# Forces redraw on focus
update_check_interval 0

################################################################################
# Keyboard Shortcuts
################################################################################
# Clipboard
map cmd+c copy_to_clipboard
map cmd+v paste_from_clipboard
map shift+insert paste_from_selection

# Window management
map cmd+n new_os_window
map cmd+w close_window
map cmd+enter new_window
map cmd+] next_window
map cmd+[ previous_window
map cmd+f move_window_forward
map cmd+b move_window_backward

# Tab management
map cmd+t new_tab
map cmd+right next_tab
map cmd+left previous_tab
map cmd+shift+right move_tab_forward
map cmd+shift+left move_tab_backward
map cmd+alt+t set_tab_title

# Layout management
map cmd+l next_layout
map cmd+shift+l last_used_layout

# Font size
map cmd+equal change_font_size all +2.0
map cmd+plus change_font_size all +2.0
map cmd+minus change_font_size all -2.0
map cmd+0 change_font_size all 0

# Window navigation by number
map cmd+1 first_window
map cmd+2 second_window
map cmd+3 third_window
map cmd+4 fourth_window
map cmd+5 fifth_window
map cmd+6 sixth_window
map cmd+7 seventh_window
map cmd+8 eighth_window
map cmd+9 ninth_window

# Special functions
map cmd+, edit_config_file
map cmd+f2 edit_config_file
map cmd+f5 load_config_file
map cmd+f6 debug_config
map cmd+f10 toggle_maximized
map cmd+f11 toggle_fullscreen
map cmd+f12 toggle_macos_secure_keyboard_entry
map cmd+shift+, load_config_file

# Scrollback
map cmd+k clear_terminal scroll active
map cmd+shift+k clear_terminal to_cursor active
map cmd+up scroll_line_up
map cmd+down scroll_line_down
map cmd+page_up scroll_page_up
map cmd+page_down scroll_page_down
map cmd+home scroll_home
map cmd+end scroll_end
map cmd+h show_scrollback
map cmd+shift+h show_last_command_output

# Miscellaneous
map cmd+alt+s paste_from_selection
map cmd+shift+escape kitty_shell window
map cmd+equal change_font_size all +1.0
map cmd+minus change_font_size all -1.0
map cmd+backspace change_font_size all 0

# Force redraw (useful if window becomes blank after waking from sleep)
map cmd+shift+f5 load_config_file

# Preserve important macOS shortcuts
clear_all_shortcuts no
