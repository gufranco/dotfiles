---
description: Code review guidelines for authors and reviewers
alwaysApply: false
---

# Code Review

## As Author

### Before Requesting Review
- Self-review the entire diff line by line
- Run all tests locally
- Verify the build passes
- Check for debugging code, console logs, commented code
- Ensure commit history is clean and logical
- Write a clear PR description. When the repo has a PR template, fill it out completely: Purpose, Implementation Details, Testing Performed, Potential Impacts, Review Checklist, Related Issues.

### PR template sections (when no template exists)
- Purpose: why the change is needed; reference issues.
- Implementation Details: how and why specific approaches were chosen.
- Testing Performed: automated (unit, integration, E2E) and manual.
- Potential Impacts: other areas of the system affected.
- Review Checklist: style guidelines, docs updated, tests passing, no new warnings.
- Related Issues: Closes #N, Refs #N.

### PR Best Practices
- Keep PRs small (< 400 lines ideally, max 1000)
- One logical change per PR
- Include before/after screenshots for UI changes
- Link to relevant tickets/issues
- Respond to all comments, even if just "Done"

```markdown
<!-- ❌ NEVER - vague PR description -->
## Description
Fixed some bugs and added features.

<!-- ✅ CORRECT - clear PR description -->
## Summary
Add email verification for new user registrations.

## Changes
- Added `sendVerificationEmail()` to auth service
- Created email verification endpoint `POST /verify-email`
- Added 24-hour expiration for verification tokens

## Testing
- [x] Unit tests for token generation
- [x] Integration tests for email sending
- [x] Manual test: full registration flow

## Screenshots
| Before | After |
|--------|-------|
| (none) | [verification email screenshot] |

Closes PROJ-1234
```

### Splitting Large PRs
| Original PR | Split Into |
|-------------|------------|
| Feature + Refactor | 1. Refactor PR → 2. Feature PR |
| Multiple features | Separate PR per feature |
| Migration + Code | 1. Migration PR → 2. Code PR |

## As Reviewer

### When Suggesting Changes
- Review the existing codebase first. Reference specific files, e.g. @path.
- Provide suggestions in incremental steps: explanation and purpose, minimal code snippet, targeted test to validate, expected outcomes and edge cases.
- Request clarification for missing context via @ references or status.md.

### Response Time
- Review within 24 hours (business hours)
- If you cannot review soon, communicate that
- Prioritize unblocking teammates

### Comment Prefixes
| Prefix | Meaning | Blocking? |
|--------|---------|-----------|
| `issue:` | Must be addressed before merge | Yes |
| `question:` | Need clarification to proceed | Yes |
| `suggestion:` | Optional improvement | No |
| `nit:` | Minor style/preference | No |
| `praise:` | Highlight good practices | No |
| `thought:` | Food for thought, no action needed | No |

### Review Mindset
- Be constructive, not critical
- Assume good intent
- Explain the "why" behind suggestions
- Offer solutions, not just problems
- Approve with comments if only nits remain
- Use "we" instead of "you": "we should" instead of "you should"

### Writing Style for Reviews
Follow the writing style rules from `00-core.mdc`:
- **No em dashes.** Never use `—` or ` — `. Use periods, commas, or colons to break up ideas
- **No parentheses in prose.** Rewrite using commas, separate sentences, or inline phrasing. Parentheses are fine in code blocks and signatures
- **Write like a human.** Comments should sound like a real person talking to a colleague. Natural, warm, professional. Not formulaic or robotic
- **Keep sentences short.** One idea per sentence
- **Use international English.** Clear, universally understood vocabulary. No regional slang

| ❌ NEVER | ✅ CORRECT |
|----------|------------|
| "This is wrong" | "issue: This might cause X. Consider Y instead" |
| "Why did you do it this way?" | "question: What was the reasoning behind X?" |
| "You should use X" | "suggestion: We could use X here for better Y" |
| "Fix this" | "nit: We usually prefer X style in this codebase" |
| "This — combined with Y — causes Z" | "This causes Z when combined with Y" |
| "the flag (which is never set) won't work" | "the flag is never set, so it won't work" |

```markdown
<!-- ❌ NEVER - unhelpful criticism -->
This code is confusing and hard to read.

<!-- ❌ NEVER - em dashes and parentheses -->
This `throw` will bubble into the `.catch()` — which means we'll track
both events (Failed and Error) for every failure.

<!-- ✅ CORRECT - constructive, natural, no em dashes or parentheses -->
suggestion: This function is doing multiple things. We could split it into
`validateInput()` and `processOrder()` for better readability and testability.

Something like:
\`\`\`typescript
const validatedData = validateInput(input);
const result = await processOrder(validatedData);
\`\`\`

<!-- ✅ CORRECT - natural tone, no em dashes -->
Heads up: this `throw` will bubble into the `.catch()` block below, which
means we'll track both "Failed" and "Error" for every expected failure.

<!-- ❌ NEVER - blocking on style -->
I would have done this differently. Blocking until changed.

<!-- ✅ CORRECT - approve with nits -->
Looks good! Left a few nits but nothing blocking. Approving.
```

## Review Checklist

### Correctness
- Does the code do what it is supposed to do?
- Are edge cases handled?
- Are error cases handled appropriately?
- Is the logic correct?

### Types and Naming
- Are types correct and consistent (no stray `any` or unchecked casts)?
- Is naming clear and consistent (no duplication or misleading names)?

### Security
- No hardcoded secrets or credentials
- Input validation present
- No SQL injection vulnerabilities
- No XSS vulnerabilities
- Proper authorization checks

### Performance
- No N+1 queries
- No unnecessary database calls
- No blocking operations in async context
- Appropriate use of caching

### Maintainability
- Code is readable and self-documenting
- Follows existing patterns
- No code duplication
- Good naming conventions

### Testing
- Tests cover the changes
- Tests cover edge cases
- Tests are readable and maintainable
- When the PR was planned with test scenarios (see `97-plan-test-scenarios.mdc`), those scenarios are implemented and passing

## QA bug reports
- Structure: Description, Environment details like device/OS/browser/version/resolution/role, Severity from Critical to Trivial, Steps to Reproduce as a numbered list, Expected vs Actual, Visual Evidence, Console/Error Logs, Additional Notes.
- One issue per report. Objective and factual. Clear, reproducible steps. Include version numbers and exact error messages.

## Engineering tickets
- Include: Description, Technical Context, Implementation Details, Acceptance Criteria as a list or Given-When-Then, Testing Considerations, Dependencies, Resource links, Estimation in story points, Priority, Sprint.
- Be specific and testable. Suggest implementation without being overly prescriptive. Identify dependencies and blockers.
