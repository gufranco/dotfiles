""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Core Settings
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" UTF-8 encoding for proper character support
set encoding=utf-8
scriptencoding utf-8
set fileencoding=utf-8

" File format detection (unix, dos, mac)
set fileformats=unix,dos,mac
set fileencodings=utf-8,ucs-bom,gb18030,gbk,gb2312,cp936

" Disable backup, swap, and undo files (not needed with proper version control)
set nobackup
set noswapfile
set noundofile

" Set leader key to comma for custom mappings
let g:mapleader = ','

" Shell configuration
if exists('$SHELL')
  set shell=$SHELL
else
  set shell=/bin/bash
endif

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Performance Optimizations
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Reduce redraw during operations for better performance
set lazyredraw
set ttyfast
set timeoutlen=300
set updatetime=100

" Faster startup
" Disable filetype detection during startup
set lazyredraw
filetype off
syntax off

" Faster scrolling and redraw
set scrolljump=3
set sidescroll=5

" Increase command and undo history
set history=1000
set undolevels=1000

" Disable unnecessary built-in plugins for faster startup
let g:loaded_netrw = 1
let g:loaded_netrwPlugin = 1
let g:loaded_2html_plugin = 1
let g:loaded_getscript = 1
let g:loaded_getscriptPlugin = 1
let g:loaded_gzip = 1
let g:loaded_logipat = 1
let g:loaded_matchit = 1
let g:loaded_matchparen = 1
let g:loaded_rrhelper = 1
let g:loaded_spellfile_plugin = 1
let g:loaded_tar = 1
let g:loaded_tarPlugin = 1
let g:loaded_vimball = 1
let g:loaded_vimballPlugin = 1
let g:loaded_zip = 1
let g:loaded_zipPlugin = 1
let g:loaded_netrwSettings = 1
let g:loaded_netrwFileHandlers = 1
let g:loaded_netrwMenu = 1

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Plugin Management
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Auto-install vim-plug if not present
if empty(glob('~/.dotfiles/vim/autoload/plug.vim'))
  silent execute '!curl -fLo ~/.dotfiles/vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'

  augroup plug
    autocmd VimEnter * PlugInstall
  augroup END
endif

call plug#begin()

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Core & Compatibility
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" vim-sensible - Sensible defaults for Vim
" Usage: Automatic - provides good defaults out of the box
Plug 'tpope/vim-sensible'

" vim-opinion - Opinionated defaults for better editing
" Usage: Automatic - adds more opinionated defaults
Plug 'rstacruz/vim-opinion'

" vim-tmux - Seamless tmux integration
" Usage: Automatic - better tmux integration
Plug 'tmux-plugins/vim-tmux'

" vim-tmux-focus-events - Focus events for tmux
" Usage: Automatic - enables focus events in tmux
Plug 'tmux-plugins/vim-tmux-focus-events'

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Theme & Appearance
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" tokyonight-vim - Tokyo Night color scheme
" Usage: Automatic - dark theme with beautiful colors
Plug 'ghifarit53/tokyonight-vim'

" lightline.vim - Light and configurable statusline
" Usage: Automatic - shows mode, git branch, file info, linter status
Plug 'itchyny/lightline.vim'

" lightline-ale - ALE integration for lightline
" Usage: Automatic - shows linter errors/warnings in statusline
Plug 'maximbaz/lightline-ale'

" vim-devicons - File type icons
" Usage: Automatic - icons in NERDTree and other file explorers
Plug 'ryanoasis/vim-devicons'

" vim-togglecursor - Cursor shape changes between insert and normal mode
" Usage: Automatic - cursor changes shape
Plug 'jszakmeister/vim-togglecursor'

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" UI Enhancements & Utilities
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" vim-startify - Fancy start screen
" Usage: Automatic - shows recent files and sessions
Plug 'mhinz/vim-startify'

" numbers.vim - Relative number smart toggle
" Usage: Automatic - shows relative numbers when appropriate
Plug 'myusuf3/numbers.vim'

" vim-illuminate - Highlight word under cursor
" Usage: Automatic - highlights all instances of word
Plug 'RRethy/vim-illuminate'

" vim-indentguides - Better indent guides
" Usage: Automatic - visual indent indicators
Plug 'thaerkh/vim-indentguides'

" CursorLineCurrentWindow - Cursorline only in current window
" Usage: Automatic - cursorline follows focus
Plug 'vim-scripts/CursorLineCurrentWindow'

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Window & Buffer Management
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" winresizer - Resize windows with comfort
" Usage: ,r - Enter resize mode (hjkl to resize)
Plug 'simeji/winresizer', { 'on': 'WinResizerStartResize' }

" ZoomWin - Zoom into/out of a window
" Usage: ,z - Zoom/Unzoom window
Plug 'vim-scripts/ZoomWin', { 'on': 'ZoomWin' }

" vim-wipeout - Wipe buffers not in any window
" Usage: ,Wipeout or :Wipeout command
Plug 'artnez/vim-wipeout', { 'on': 'Wipeout' }

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Language Support & Linting
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" ALE - Asynchronous Lint Engine
" Usage: Automatic - lints and fixes on save
" Commands: ,ww (fix all), ,wc (check)
Plug 'dense-analysis/ale'

" coc.nvim - LSP client for Vim
" Usage: gd (definition), gy (type), gi (implementation), gr (references)
" K or gh (hover), <leader>co (outline), <leader>cr (rename), <leader>cf (format)
Plug 'neoclide/coc.nvim', { 'branch': 'release', 'do': ':CocInstall coc-snippets coc-tsserver coc-prettier coc-eslint coc-css coc-lists coc-highlight coc-json' }

" vim-polyglot - Language packs for Vim
" Usage: Automatic - syntax support for many languages
Plug 'sheerun/vim-polyglot'

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" File Navigation & Management
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" NERDTree - File system explorer
" Usage: ,n - Toggle file tree
Plug 'scrooloose/nerdtree', { 'on': 'NERDTreeToggle' }

" nerdtree-git-plugin - Git status in NERDTree
" Usage: Automatic - shows git status in file tree
Plug 'Xuyuanp/nerdtree-git-plugin', { 'on': 'NERDTreeToggle' }

" ctrlp.vim - Fuzzy file finder
" Usage: Ctrl+P - Find files (matches filenames)
Plug 'ctrlpvim/ctrlp.vim', { 'on': ['CtrlP', 'CtrlPMixed', 'CtrlPMRU', 'CtrlPBuffer'] }

" denite.nvim - Unified interface for neovim/vim
" Usage: :Denite file_rec or :Denite buffer
Plug 'Shougo/denite.nvim', { 'on': ['Denite', 'DeniteBufferDir', 'DeniteFileRec'] }

" vim-signify - Show git status in gutter
" Usage: Automatic - shows git changes with +/-/~
Plug 'mhinz/vim-signify'

" vim-fugitive - Git wrapper
" Usage: :Gstatus, :Gblame, :Gdiff, :Gwrite, :Gread
Plug 'tpope/vim-fugitive'

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Editing & Text Manipulation
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" vim-commentary - Comment out lines with ,,gc
" Usage: gcc (comment line), gc (visual), ,gc (count/selection)
Plug 'tpope/vim-commentary'

" vim-surround - Deal with surroundings like quotes, brackets
" Usage: cs"' (change), ds" (delete), ysiw" (add), S" (visual)
Plug 'tpope/vim-surround'

" vim-repeat - Enable repeating supported plugin maps with .
" Usage: Automatic - dot repeat for plugin commands
Plug 'tpope/vim-repeat'

" vim-visual-multi - Multiple cursors for Vim
" Usage: Ctrl+N (select word), Ctrl+X (select regex), Ctrl+A (select all)
Plug 'mg979/vim-visual-multi', { 'branch': 'master' }

" vim-paste-easy - Simple paste with correct indentation
" Usage: Automatic - smart paste behavior
Plug 'roxma/vim-paste-easy'

" vim-pasta - Pasta: code aware pasting
" Usage: Automatic - pastes at proper indentation level
Plug 'sickill/vim-pasta'

" vim-better-whitespace - Better whitespace highlighting and removal
" Usage: Automatic - highlights trailing whitespace
" Commands: :StripWhitespace or :StripWhitespaceLines
Plug 'ntpeters/vim-better-whitespace'

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Clipboard & Yanking
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" vim-easyclip - Simplified clipboard functionality
" Usage: m (move), y (yank), Y (yank line), yy (yank line to clipboard)
Plug 'svermeulen/vim-easyclip'

" neoyank.vim - Improved yank history
" Usage: Automatic - enhanced yank history
Plug 'Shougo/neoyank.vim'

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Navigation & Movement
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" vim-easymotion - Vim motions on speed
" Usage: f<character> - Jump to character, <leader>s (search)
Plug 'easymotion/vim-easymotion', { 'on': ['<Plug>(easymotion-overwin-f)', '<Plug>(easymotion-s)', '<Plug>(easymotion-w)', '<Plug>(easymotion-b)'] }

" vim-search-pulse - Pulse cursor line when searching
" Usage: Automatic - cursor line pulses on search
Plug 'inside/vim-search-pulse'

" matchit - Extended matching for the % command
" Usage: % - Jump to matching bracket
Plug 'tmhedberg/matchit'

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Search & Replace
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" far.vim - Find and Replace
" Usage: :Far foo bar - find 'foo' and replace with 'bar'
" :Farp foo bar - find and replace with preview
Plug 'brooth/far.vim', { 'on': ['Far', 'Farundo', 'Farp', 'Farundo'] }

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Completion & Keybindings
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" supertab - Enhanced tab completion
" Usage: Tab - Complete (uses context to determine completion)
Plug 'ervandew/supertab'

" vim-which-key - Which key for Vim
" Usage: , - Press leader to see available key maps
Plug 'liuchengxu/vim-which-key', { 'on': ['WhichKey', 'WhichKey!'] }

call plug#end()

" Enable filetype and syntax after plugins are loaded
filetype plugin indent on
syntax enable

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Editor Behavior
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Highlight current line (disable if slow)
set cursorline
" Highlight current column
set cursorcolumn
" Column indicator at column 80
set colorcolumn=80
" Always show status line
set laststatus=2
set statusline=%f\ %h%w%m%r%=%-14.(%l,%c%V%)\ %P

" Height of command line
set cmdheight=1
" Show cursor position
set ruler
" Show command in bottom right
set showcmd

" Case insensitive search
set ignorecase
" Case sensitive if caps in pattern
set smartcase
" Incremental search
set incsearch
" Highlight search results
set hlsearch
" Wrap search around file
set wrapscan
" Apply substitutions globally
set gdefault

" Auto-indent new lines
set autoindent
" Smart auto-indent
set smartindent
" Use spaces instead of tabs
set expandtab
" Tab width
set tabstop=2
" Indent width
set shiftwidth=2
" Tab behavior in insert mode
set softtabstop=2
" Copy indent on :setup language
set copyindent
" Preserve indent on reload
set preserveindent
" C-style indenting
set cindent
" C indentation options
set cinoptions=g0,:0,N-s,E-s

" Show line numbers
set number
" Show relative line numbers
set relativenumber
" Width of line number column
set numberwidth=4

" Wrap long lines
set wrap
" Break at word boundaries
set linebreak
" Don't show list chars
set nolist
" Don't auto-wrap
set textwidth=0
" No margin for wrapping
set wrapmargin=0

" Keep 8 lines above/below cursor
set scrolloff=8
" Jump 5 lines at a time
set scrolljump=5

" Fold by indent
set foldmethod=indent
" Keep most folds open
set foldlevel=99
" Max 3 levels of nesting
set foldnestmax=3

" New windows below
set splitbelow
" New windows to the right
set splitright
" Minimum window height
set winminheight=0
" Minimum window width
set winminwidth=0
" Minimum window width
set winwidth=30
" Minimum window height
set winheight=5
" Minimum window height
set winminheight=5
" Minimum window width
set winminwidth=10

" Max tabs
set tabpagemax=15
" Show tab line only if more than one
set showtabline=1

" Allow hidden buffers
set hidden
" Buffer switching behavior
set switchbuf=useopen,usetab,newtab

" Completion
set completeopt+=noinsert,noselect
" Don't show completion messages
set shortmess+=c
" Completion mode
set wildmode=longest:full,full
set wildignore=*.o,*.obj,*.dylib,*.bin,*.dll,*.exe
set wildignore+=*/.git/*,*/.svn/*,*/node_modules/*
set wildignore+=*.jpg,*.jpeg,*.png,*.gif,*.bmp,*.tiff
set wildignore+=*.pdf,*.psd,*.ai,*.eps
set wildignore+=*.zip,*.tar.gz,*.tar.bz2,*.rar,*.7z
set wildignore+=*.swp,*.swo,*~

" Performance: Limit syntax highlighting for large files
if has("autocmd")
  augroup large_file
    autocmd!
    autocmd BufReadPre *
          \ if getfsize(expand("%")) > 1024 * 1024 * 10
          \ | set syntax=off
          \ | set foldmethod=manual
          \ | set readonly
          \ | set buftype=nowrite
          \ | set undolevels=-1
          \ | endif
  augroup END
endif

" Enable mouse in all modes
set mouse=a
" Hide mouse when typing
set mousehide
" Mouse mode
set mousemodel=popup
" Double-click time
set mousetime=500
" Selection mode
set selectmode=mouse,key
" Key model
set keymodel=startsel,stopsel
" Focus follows mouse
set mousefocus
" Mouse features
set mousef=all
" Terminal mouse
set ttymouse=xterm2

" Max column for syntax highlight (lower = faster on large files)
set synmaxcol=200
" Use old regex engine (faster)
set re=1
" Disable cursor blinking (saves CPU)
set guicursor=

" No error bells
set noerrorbells
" No visual bell
set novisualbell
" Disable beep
set t_vb=

" Clipboard
if has('clipboard')
  " Use system clipboard
  set clipboard^=unnamed,unnamedplus
endif

" Always show sign column
set signcolumn=yes

" Switch buffer behavior
set switchbuf=useopen,usetab,newtab
" Preview window height
set previewheight=12
" Help window height
set helpheight=12
" Popup menu height
set pumheight=10
" Popup menu width
set pumwidth=15

" Error format
set errorformat=%f:%l:%c:%m

" Grep
if executable('rg')
  set grepprg=rg\ --vimgrep\ --no-heading
  set grepformat=%f:%l:%c:%m
endif

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Key Mappings
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Disable arrow keys to force learning proper navigation
noremap <Up> <NOP>
noremap <Down> <NOP>
noremap <Left> <NOP>
noremap <Right> <NOP>

" Clear search highlight with Enter
nnoremap <CR> :nohlsearch<CR><CR>

" Source vimrc
nmap <Leader>s :source $MYVIMRC<CR>
" Edit vimrc
nmap <Leader>v :edit $MYVIMRC<CR>
" Write file
nmap <Leader>w :w<CR>
" Quit
nmap <Leader>q :q<CR>

" Next buffer
nmap <Leader>bn :bnext<CR>
" Previous buffer
nmap <Leader>bp :bprev<CR>
" Delete buffer
nmap <Leader>bd :bdelete<CR>

" Navigate left
nmap <Leader>h <C-w>h
" Navigate down
nmap <Leader>j <C-w>j
" Navigate up
nmap <Leader>k <C-w>k
" Navigate right
nmap <Leader>l <C-w>l

" Equalize windows
nmap <Leader>= <C-w>=
" Increase height
nmap <Leader>+ <C-w>+
" Decrease height
nmap <Leader>- <C-w>-

" Toggle file tree
nmap <Leader>n :NERDTreeToggle<CR>
" Resize windows
nmap <Leader>r :WinResizerStartResize<CR>
" Zoom window
nmap <Leader>z :ZoomWin<CR>

" WhichKey
nnoremap <silent> <leader> :WhichKey ','<CR>

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Theme Configuration
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
try
  let g:tokyonight_style = 'night'
  let g:tokyonight_enable_italic = 1
  colorscheme tokyonight
catch
  colorscheme desert
endtry
set background=dark

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Plugin Configurations
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" NERDTree - File explorer configuration
" Usage: ,n - Toggle file tree
" Features: Auto-delete buffer, minimal UI, quit on open, show hidden files
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:NERDTreeAutoDeleteBuffer = 1
let g:NERDTreeMinimalUI = 1
let g:NERDTreeQuitOnOpen = 1
let g:NERDTreeShowHidden = 1
let g:NERDTreeWinSize = 30
let g:NERDTreeChDirMode = 2
let g:NERDTreeShowLineNumbers = 0
let g:NERDTreeShowBookmarks = 1
let g:NERDTreeBookmarksFile = $HOME . '/.cache/nerdtree_bookmarks'
let g:NERDTreeMouseMode = 2
let g:NERDTreeRespectWildIgnore = 1
let g:NERDTreeSortOrder = ['\/$', '*', '\.swp$', '\.bak$', '\~$']
let g:NERDTreeIgnore = [
\ '^\.git$[[dir]]',
\ '^node_modules$[[dir]]',
\ '^dist$[[dir]]',
\ '^build$[[dir]]',
\ '^ios$[[dir]]',
\ '^android$[[dir]]',
\ '^\.cache$[[dir]]',
\ '^\.tmp$[[dir]]',
\ '\.pyc$',
\ '\.pyo$',
\ '\.pyd$',
\ '__pycache__$[[dir]]',
\ '\.DS_Store$',
\ '\.swp$',
\ '\.swo$',
\ '\.bak$',
\ '\~$'
\ ]

augroup nerdtree
  autocmd BufEnter * if (winnr("$") == 1 && exists("b:NERDTree") && b:NERDTree.isTabTree()) | q | endif
augroup END

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Lightline - Statusline configuration
" Usage: Automatic - shows mode, git branch, file info, linter status
" Features: Tokyo Night colorscheme, ALE integration, git branch display
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:lightline = {
  \ 'colorscheme': 'tokyonight',
  \ 'active': {
  \   'left': [
  \     [ 'mode', 'paste' ],
  \     [ 'gitbranch', 'readonly', 'filename', 'modified' ]
  \   ],
  \   'right': [
  \     [ 'linter_checking', 'linter_errors', 'linter_warnings', 'linter_ok' ]
  \   ]
  \ },
  \ 'component': {
  \   'lineinfo': ' %3l:%-2v',
  \ },
  \ 'component_function': {
  \   'gitbranch': 'fugitive#head',
  \ },
  \ 'separator': {
  \   'left': '', 'right': ''
  \ },
  \ 'subseparator': {
  \   'left': '', 'right': ''
  \ },
  \ 'component_expand': {
  \   'linter_checking': 'lightline#ale#checking',
  \   'linter_warnings': 'lightline#ale#warnings',
  \   'linter_errors': 'lightline#ale#errors',
  \   'linter_ok': 'lightline#ale#ok'
  \ },
  \ 'component_type': {
  \   'linter_checking': 'left',
  \   'linter_warnings': 'warning',
  \   'linter_errors': 'error',
  \   'linter_ok': 'left',
  \ }
\ }

let g:lightline#ale#indicator_checking = ""
let g:lightline#ale#indicator_warnings = ""
let g:lightline#ale#indicator_errors = ""
let g:lightline#ale#indicator_ok = ""

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" ALE - Linting configuration
" Usage: Automatic - lints and fixes on save, ,ww (fix all), ,wc (check)
" Features: ESLint, Prettier, Black, rustfmt, gofmt, and more
" Linters: JavaScript, TypeScript, Python, Go, Rust, HTML, CSS, JSON, Lua, Vim
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:ale_lint_on_text_changed = 'never'
let g:ale_lint_on_save = 1
let g:ale_fix_on_save = 1
let g:ale_lint_on_enter = 1
let g:ale_lint_on_insert_leave = 1
let g:ale_lint_on_filetype_changed = 1
let g:ale_completion_enabled = 1
let g:ale_completion_autoimport = 1
let g:ale_sign_column_always = 1
let g:ale_set_highlights = 1
let g:ale_set_loclist = 1
let g:ale_set_quickfix = 0
let g:ale_open_list = 0
let g:ale_keep_list_window_open = 0
let g:ale_hover_to_preview = 1
let g:ale_hover_cursor = 1
let g:ale_floating_preview = 1
let g:ale_floating_window_border = ['â”‚', 'â”€', 'â•­', 'â•®', 'â•¯', 'â•°']
let g:ale_echo_cursor = 1
let g:ale_echo_msg_format = '[%linter%] %s [%severity%]'
let g:ale_detail_to_floating_preview = 1
let g:ale_maximum_file_size = 500000
let g:ale_pattern_options = {
\ '\.min\.js$': {'ale_linters': [], 'ale_fixers': []},
\ '\.min\.css$': {'ale_linters': [], 'ale_fixers': []}
\ }

let g:ale_linters = {
  \ 'javascript': ['eslint'],
  \ 'typescript': ['eslint'],
  \ 'vim': ['vint'],
  \ 'python': ['flake8'],
  \ 'lua': ['luacheck'],
  \ 'go': ['gofmt'],
  \ 'rust': ['cargo'],
  \ 'html': ['htmlhint'],
  \ 'css': ['stylelint'],
  \ 'json': ['jsonlint']
\ }

let g:ale_fixers = {
  \ 'javascript': ['prettier', 'eslint'],
  \ 'typescript': ['prettier', 'eslint'],
  \ 'python': ['black', 'isort'],
  \ 'lua': ['luafmt'],
  \ 'go': ['gofmt'],
  \ 'rust': ['rustfmt'],
  \ 'html': ['prettier'],
  \ 'css': ['prettier'],
  \ 'json': ['prettier']
\ }

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" CtrlP - Fuzzy finder configuration
" Usage: Ctrl+P - Find files (matches filenames)
" Features: Fuzzy file search, respects .gitignore, uses rg/ag/git
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:ctrlp_custom_ignore = {
  \ 'dir':  '\v[\/](\.git|\.hg|\.svn|node_modules|dist|build|android|ios|\.cache|\.tmp)$',
  \ 'file': '\v\.(gitkeep|log|gif|jpg|jpeg|png|psd|DS_Store|min\.js|min\.css)$'
\ }
let g:ctrlp_show_hidden = 1
let g:ctrlp_use_caching = 0
let g:ctrlp_max_files = 10000
let g:ctrlp_max_depth = 40
let g:ctrlp_working_path_mode = 'ra'
let g:ctrlp_root_markers = ['.git', '.hg', '.svn', 'package.json', 'composer.json']
let g:ctrlp_match_window = 'bottom,order:btt,min:1,max:10,results:50'
let g:ctrlp_prompt_mappings = {
  \ 'PrtSelectMove("j")': ['<c-n>', '<down>'],
  \ 'PrtSelectMove("k")': ['<c-p>', '<up>'],
  \ 'PrtHistory(-1)': ['<c-j>'],
  \ 'PrtHistory(1)': ['<c-k>'],
  \ 'ToggleFocus()': ['<c-t>'],
  \ 'ToggleByFname()': ['<c-d>'],
  \ 'ToggleType(1)': ['<c-f>', '<c-up>'],
  \ 'ToggleType(-1)': ['<c-b>', '<c-down>'],
  \ 'PrtCurStart()': ['<c-a>'],
  \ 'PrtCurEnd()': ['<c-e>'],
  \ 'PrtCurLeft()': ['<c-h>', '<c-left>', '<c-^>'],
  \ 'PrtCurRight()': ['<c-l>', '<c-right>'],
  \ 'PrtClearCache()': ['<F5>'],
  \ 'PrtDeleteEnt()': ['<F7>'],
  \ 'CreateNewFile()': ['<c-y>'],
  \ 'MarkToOpen()': ['<c-z>'],
  \ 'OpenMulti()': ['<c-o>'],
  \ 'PrtExit()': ['<esc>', '<c-c>', '<c-g>'],
\ }

if executable('rg')
  let g:ctrlp_user_command = 'rg %s --files --hidden --follow --color=never --glob "!.git/*" --glob "!node_modules/*" --glob "!dist/*" --glob "!build/*"'
elseif executable('ag')
  let g:ctrlp_user_command = 'ag %s -l --nocolor -g ""'
else
  let g:ctrlp_user_command = ['.git/', 'git --git-dir=%s/.git ls-files -oc --exclude-standard']
endif

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Vim Multiple Cursors
" Usage: Ctrl+N (select word), Ctrl+X (select regex), Ctrl+A (select all)
" Features: Multiple cursors for efficient text editing
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:multi_cursor_quit_key = '<Esc>'

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" EasyMotion
" Usage: f<character> - Jump to character, <leader>s (search)
" Features: Jump to any character in the file with two keystrokes
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:EasyMotion_do_mapping = 0
nmap f <Plug>(easymotion-overwin-f)
let g:EasyMotion_smartcase = 1
let g:EasyMotion_use_upper = 1
let g:EasyMotion_keys = 'etovxqpdygfblzhckisuran'

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Easyclip
" Usage: m (move), y (yank), Y (yank line), yy (yank line to clipboard)
" Features: Enhanced clipboard management
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:EasyClipAlwaysMoveCursorToEndOfPaste = 1

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Supertab
" Usage: Tab - Complete (uses context to determine completion)
" Features: Enhanced tab completion
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:SuperTabDefaultCompletionType = '<c-n>'

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" WhichKey
" Usage: , - Press leader to see available key maps
" Features: Interactive key mapping documentation
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
nnoremap <silent> <leader> :WhichKey ','<CR>

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Startify
" Usage: Automatic - shows recent files and sessions on startup
" Features: Custom start screen with session management
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:startify_custom_header = []

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Coc - LSP configuration
" Usage: gd (definition), gy (type), gi (implementation), gr (references)
"        K or gh (hover), <leader>co (outline), <leader>cr (rename)
"        <leader>cf (format), <leader>ca (code action)
" Features: Language Server Protocol support for many languages
" Extensions: TypeScript, Python, Go, Rust, JSON, CSS, and more
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:coc_global_extensions = [
  \ 'coc-snippets',
  \ 'coc-tsserver',
  \ 'coc-prettier',
  \ 'coc-eslint',
  \ 'coc-css',
  \ 'coc-lists',
  \ 'coc-highlight',
  \ 'coc-json',
  \ 'coc-python',
  \ 'coc-go',
  \ 'coc-rust-analyzer'
\ ]

" Coc performance settings
let g:coc_disable_startup_warning = 1
let g:coc_config_home = $HOME . '/.config/coc'
let g:coc_data_home = $HOME . '/.cache/coc'

" Coc completion settings
let g:coc_enable_locationlist = 0
let g:coc_enable_diagnostic_sign = 1
let g:coc_diagnostic_sign_priority = 10
let g:coc_diagnostic_sign_error = 'âœ—'
let g:coc_diagnostic_sign_warning = 'âš '
let g:coc_diagnostic_sign_info = 'â„¹'
let g:coc_diagnostic_sign_hint = 'ðŸ’¡'

" Coc hover settings
let g:coc_hover_disable = 0
let g:coc_hover_max_height = 20
let g:coc_hover_max_width = 80

" Coc snippet settings
let g:coc_snippet_next = '<tab>'
let g:coc_snippet_prev = '<s-tab>'

" Check if Node.js is available before enabling Coc (handled by nvm)
if executable('node')
  inoremap <silent><expr> <c-space> coc#refresh()

  nmap <silent> gd <Plug>(coc-definition)
  nmap <silent> gy <Plug>(coc-type-definition)
  nmap <silent> gi <Plug>(coc-implementation)
  nmap <silent> gr <Plug>(coc-references)

  function! s:show_documentation()
    if &filetype ==# 'vim'
      execute 'h '.expand('<cword>')
    else
      call CocAction('doHover')
    endif
  endfunction

  nnoremap <silent> K :call <SID>show_documentation()<CR>
  nnoremap <silent> gh :call <SID>show_documentation()<CR>

  augroup coc_cursorhold
    autocmd CursorHold * silent call CocActionAsync('highlight')
  augroup END

  nnoremap <silent> <leader>co  :<C-u>CocList outline<cr>
  nnoremap <silent> <leader>cs  :<C-u>CocList -I symbols<cr>
  nnoremap <silent> <leader>cl  :<C-u>CocList locationlist<cr>
  nnoremap <silent> <leader>cc  :<C-u>CocList commands<cr>
  nnoremap <silent> <leader>cR  :<C-u>CocRestart<CR>
  nnoremap <silent> <leader>cx  :<C-u>CocList extensions<cr>
  nmap <leader>cr  <Plug>(coc-rename)
  nmap <leader>cf  <Plug>(coc-format-selected)
  vmap <leader>cf  <Plug>(coc-format-selected)
  vmap <leader>ca  <Plug>(coc-codeaction-selected)
  nmap <leader>ca  <Plug>(coc-codeaction-selected)
else
  echo "Node.js not found. Coc.nvim disabled. Install Node.js via nvm to enable language server features."
endif
