---
description: Dependency management
globs: "**/package.json"
alwaysApply: false
---

# Dependencies

## Before Adding
1. **Ask permission** - Never add without approval
2. **Check existing** - Maybe already solved
3. **Evaluate** - Recent commits? Vulnerabilities?
4. **Size** - Avoid heavy packages for simple tasks

```markdown
<!-- ❌ NEVER - install without checking -->
"I'll add lodash for this array function."

<!-- ✅ CORRECT - evaluation process -->
"I need to deep clone objects. Before adding a package:
1. Check existing: We already have structuredClone() in Node 17+
2. If needed, evaluate options:
   - lodash.clonedeep: 18KB, well maintained
   - clone-deep: 3KB, last commit 2 years ago
   - native: structuredClone() - 0KB, built-in
3. Recommendation: Use native structuredClone()"
```

| ❌ NEVER | ✅ CORRECT |
|----------|------------|
| Add `moment` for date formatting | Use native `Intl.DateTimeFormat` |
| Add `lodash` for one function | Import only needed: `lodash.debounce` |
| Add `axios` in Node 18+ | Use native `fetch` |
| Add `uuid` | Use native `crypto.randomUUID()` |

## Rules
- Pin exact versions: `"1.2.3"` not `"^1.2.3"`
- One package at a time
- Run `npm audit` after adding
- Use `--save-dev` for dev dependencies

```bash
# ❌ NEVER - unpinned versions
npm install lodash
# Results in: "lodash": "^4.17.21"

# ✅ CORRECT - pinned exact version
npm install lodash@4.17.21 --save-exact
# Results in: "lodash": "4.17.21"

# ❌ NEVER - dev dependency in production
npm install jest

# ✅ CORRECT - dev dependency marked correctly
npm install jest --save-dev

# ✅ CORRECT - always audit after adding
npm install new-package --save-exact && npm audit
```

| ❌ NEVER | ✅ CORRECT |
|----------|------------|
| `"^1.2.3"` | `"1.2.3"` |
| `"~1.2.3"` | `"1.2.3"` |
| `">=1.2.3"` | `"1.2.3"` |
| `"*"` | `"1.2.3"` |

## Checklist
- [ ] User approved
- [ ] No existing solution
- [ ] Actively maintained
- [ ] Acceptable bundle size
- [ ] No critical vulnerabilities
